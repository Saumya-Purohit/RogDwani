<!doctype html>
<html>
  <head>
    <title>RogDhwani</title>
    <link rel="icon" type="image/x-icon" href="/images/RogDhwani-logos/favicon.ico">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
    <link rel="stylesheet" href="css/styles.css">
    
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>
    <script src='https://cdn.plot.ly/plotly-latest.min.js'></script>    
    <script src="js/script.js"></script>
  </head>
 <body onload="plot();">
  <!-- <body> -->
  <div class="container" >
  <div class="row" >
    <!-- <div> -->
      <div class="Mid-Aligner" align="center">
      <table style="margin-left:auto;margin-right:auto">
        <tr>
          <td><h1 id="mainHeading" class="border col col-md-6 text-right"><b>RogDhwani</b></h1>  </td>
          <td> <img src="./images/RogDhwani-logos/human_upper_body.png" class="pull-center"></td>
        </tr>
      </table>
    </div>
      
     
    <!-- </div> -->
  </div>
  <div class="row" style="float:left">
    <h2 id="mainHeading2" class="col-lg-12 col-md-6 ">Welcome Dr. Sumit Sharma!</h2>
   
  </div>

  <div class="row" style="float:right" >
    <div id="clock" class="time">
      <span class="hms"></span>
      <span class="ampm"></span>
      <br>
      <span class="date"></span>
    </div>
  </div>

 </div>
   <br>
<div class="container">
  <div>      
    <div class="row"> 
        <h5 class="col-md-3"><b>Patient Name :</b><span>Mr. Anand Pandey</span> </h1>
        <h5 class="col-md-3"><b>Age:</b><span>56</span></h1>
        <h5 class="col-md-3"><b>Last Visit: </b><span>30 days ago</span> </h1>
        <h5 class="col-md-3"><b>Last Diagnosis: </b><span>Healthy Lung Sounds</span></h1>
    </div>      
</div>
  <div id='myDiv'><!-- Plotly chart will be drawn inside this DIV --></div>
  <form action="/sendData" method="POST">
    <div class="form-row">
      <div class="form-group col-md-6">
        <label for="inputState">Signal Quality</label>
        <select name="signalQuality" id="signalQuality" class="form-control">
          <option selected>Low</option>
          <option>Low</option>
          <option>Medium</option>
          <option>High</option>
        </select>
      </div>
      <div class="form-group col-md-6">
        <label for="inputState">Signal Duration</label>
        <select name="signalDuration" id="signalDuration" class="form-control">
          <option selected>Long : 5 sec</option>
          <option>Short : 0.1 sec</option>
          <option>Medium : 1 sec</option>
          <option>Long : 5 sec</option>
        </select>
      </div>
    </div>
    <button id="btnStart" class="btn btn-primary btn-lg btn-block">Start</button>
  </form>
  </div>
</div>
</body>
  <script type='text/javascript'>
    // window.onload = function plot() {
    var interval;
    var plotDiv = 'myDiv';
    function plot() {

      Plotly.newPlot(plotDiv, [{
        y: [],
        mode: 'lines',
        line: {color: '#80CAF6'}
      }]);

      var cnt = 0;

      interval = setInterval(function updatePlot() 
      {                    
        let external = fetch("/getData");

        external.then(res =>
          res.json()).then(d => {
            var datas = d.data;             
            // console.log(datas)
            for(var i = 0; i < datas.length; i++)
            // Plotly.extendTraces('myDiv', { y: [[datas]] }, [0])
            {
              value = datas[i]              
              Plotly.extendTraces(plotDiv, { y: [[value]] }, [0])
            }
          }
        )

        if(++cnt === 100) clearInterval(interval);
      }, 1000);
    }
    // $(function() {
    //       $('#btnStart').on('click', function(e) {
    //         let external = fetch("/sendData");
    //         Session["controlMsg"] ="This is my session";
    //         external.then(res =>
    //           res.json()).then(d => {
    //             //do nothing
    //             // var quality = document.getElementById("signalQuality").value;
    //             // var duration = document.getElementById("signalDuration").value;                                

    //             document.getElementById("mainHeading").innerHTML += " Updating!"; 
    //             clearInterval(interval);
    //             // Plotly.deleteTraces(plotDiv, 0);
   
    //             plot();
    //             // updatePlot();
    //             // console.log(document.getElementById(plotDiv).y);
    //           }
    //         )
    //       });
    //     });
    function updateTime() {
      var dateInfo = new Date();
    
      /* time */
      var hr,
        _min = (dateInfo.getMinutes() < 10) ? "0" + dateInfo.getMinutes() : dateInfo.getMinutes(),
        sec = (dateInfo.getSeconds() < 10) ? "0" + dateInfo.getSeconds() : dateInfo.getSeconds(),
        ampm = (dateInfo.getHours() >= 12) ? "PM" : "AM";
    
      // replace 0 with 12 at midnight, subtract 12 from hour if 13â€“23
      if (dateInfo.getHours() == 0) {
        hr = 12;
      } else if (dateInfo.getHours() > 12) {
        hr = dateInfo.getHours() - 12;
      } else {
        hr = dateInfo.getHours();
      }
    
      var currentTime = hr + ":" + _min + ":" + sec;
    
      // print time
      document.getElementsByClassName("hms")[0].innerHTML = currentTime;
      document.getElementsByClassName("ampm")[0].innerHTML = ampm;
    
      /* date */
      var dow = [
          "Sunday",
          "Monday",
          "Tuesday",
          "Wednesday",
          "Thursday",
          "Friday",
          "Saturday"
        ],
        month = [
          "January",
          "February",
          "March",
          "April",
          "May",
          "June",
          "July",
          "August",
          "September",
          "October",
          "November",
          "December"
        ],
        day = dateInfo.getDate();
    
      // store date
      var currentDate = dow[dateInfo.getDay()] + ", " + month[dateInfo.getMonth()] + " " + day;
    
      document.getElementsByClassName("date")[0].innerHTML = currentDate;
    };
    
    // print time and date once, then update them every second
    updateTime();
    setInterval(function() {
      updateTime()
    }, 1000);
  </script>
</html>